{
  "mo_process_status_management": {
    "overview": {
      "purpose": "Manage and track the status of manufacturing processes for parts within a Manufacturing Order (MO)",
      "data_structure": {
        "database_collection": "Parts_Table",
        "process_fields": ["Process1", "Process2", "Process3", "Process4", "Process5"],
        "status_fields": ["Process1_Status", "Process2_Status", "Process3_Status", "Process4_Status", "Process5_Status"],
        "status_options": ["None", "In Progress", "Done", "Rejected", "Cancelled"]
      }
    },
    "data_fetching_from_database": {
      "function_name": "fetchMOData(moName)",
      "location": "Line 1170-1280",
      "fetching_process": {
        "step1_authentication": {
          "function": "authenticate()",
          "purpose": "Verify user is logged in before fetching data",
          "error_handling": "Throws error if authentication fails"
        },
        "step2_database_query": {
          "collection": "Parts_Table",
          "method": "getList(1, 50, options)",
          "query_options": {
            "sort": "-created",
            "filter": "MO_Name = \"${moName}\"",
            "fields": "id,MO_Name,Part_Code,Part_Name,Quantity,Part_Material,Part_Thickness,Part_Color,Process1,Process1_Status,Process2,Process2_Status,Process3,Process3_Status,Process4,Process4_Status,Process5,Process5_Status,Part_Pic"
          },
          "pagination": "Fetches up to 50 records per page"
        },
        "step3_data_processing": {
          "process_filtering": "Filters out empty processes (Process2-5 only shown if they have content)",
          "status_mapping": "Maps database status values to UI display",
          "image_url_generation": "Creates file URLs for part images"
        }
      },
      "data_structure_processing": {
        "process_array_creation": {
          "code_location": "Line 1220-1225",
          "logic": "Creates array of process objects with name, value, and status",
          "filtering": "index === 0 || (p.value && p.value.trim() !== '')",
          "explanation": "Process1 always included, Process2-5 only if they have content"
        },
        "ui_rendering": {
          "table_generation": "Creates HTML table rows for each part",
          "process_display": "Shows process name and status badge for each process",
          "status_badge_creation": "Generates clickable status badges with dropdown menus"
        }
      },
      "error_handling": {
        "no_data_found": "Shows 'No parts found for Manufacturing Order' message",
        "fetch_error": "Shows error message in table cell",
        "authentication_error": "Redirects to login page"
      }
    },
    "status_change_mechanism": {
      "change_tracking_system": {
        "data_structure": "const statusChanges = new Map()",
        "location": "Line 403",
        "purpose": "Store pending status changes in memory before saving to database",
        "key_format": "${recordId}-${processName}",
        "value_format": "newStatus (string)"
      },
      "status_update_function": {
        "function_name": "updateStatus(recordId, newStatus, processName, event)",
        "location": "Line 475-520",
        "parameters": {
          "recordId": "Database record ID of the part",
          "newStatus": "New status value to set",
          "processName": "Process field name (Process1, Process2, etc.)",
          "event": "Click event object"
        },
        "execution_steps": {
          "step1_ui_update": {
            "status_badge_update": "Updates badge class and text content",
            "dropdown_update": "Updates selected option in dropdown menu",
            "dropdown_close": "Closes the status dropdown"
          },
          "step2_change_tracking": {
            "change_key_creation": "Creates key as '${recordId}-${processName}'",
            "change_storage": "Stores new status in statusChanges Map",
            "indicator_update": "Calls updateChangesIndicator()"
          },
          "step3_completion_recalculation": {
            "process_collection": "Gathers all process statuses from UI",
            "percentage_calculation": "Calls calculateCompletionPercentage()",
            "display_update": "Updates progress bar and percentage text",
            "mo_status_update": "Recalculates and updates overall MO status"
          }
        }
      },
      "status_dropdown_functionality": {
        "function_name": "toggleStatusDropdown(event, recordId, processName)",
        "location": "Line 1350-1370",
        "behavior": {
          "dropdown_toggle": "Opens/closes status dropdown menu",
          "other_dropdowns_close": "Closes all other open dropdowns",
          "selected_option_update": "Highlights current status in dropdown"
        },
        "dropdown_structure": {
          "html_generation": "Generated dynamically in fetchMOData",
          "options": "None, In Progress, Done, Rejected, Cancelled",
          "click_handlers": "Each option calls updateStatus() with appropriate parameters"
        }
      },
      "change_indicator_system": {
        "function_name": "updateChangesIndicator()",
        "location": "Line 522-532",
        "purpose": "Show user how many changes are pending and enable/disable save button",
        "logic": {
          "pending_changes": "statusChanges.size > 0",
          "indicator_text": "Shows '${count} change(s) pending'",
          "save_button_state": "Enabled when changes exist, disabled when none"
        }
      }
    },
    "data_saving_to_database": {
      "save_function": {
        "function_name": "saveAllChanges()",
        "location": "Line 1300-1340",
        "trigger": "User clicks 'Done Changes' button",
        "purpose": "Save all pending status changes to database"
      },
      "saving_process": {
        "step1_preparation": {
          "button_disable": "Disables save button to prevent multiple saves",
          "loading_state": "Shows spinner and 'Saving...' text",
          "change_logging": "Logs all pending changes to console"
        },
        "step2_batch_processing": {
          "iteration": "Loops through all entries in statusChanges Map",
          "key_parsing": "Splits '${recordId}-${processName}' key",
          "data_preparation": "Creates update object with process status field"
        },
        "step3_database_update": {
          "collection": "Parts_Table",
          "method": "update(recordId, data)",
          "data_structure": {
            "Process1_Status": "newStatus",
            "Process2_Status": "newStatus",
            "Process3_Status": "newStatus",
            "Process4_Status": "newStatus",
            "Process5_Status": "newStatus"
          },
          "error_handling": "Throws error if any update fails"
        },
        "step4_cleanup": {
          "changes_clear": "Clears statusChanges Map",
          "indicator_reset": "Resets change indicator",
          "success_message": "Shows 'Changes saved successfully!' for 3 seconds"
        },
        "step5_data_refresh": {
          "ui_sync": "Refreshes data to ensure UI matches database",
          "function_call": "fetchMOData(currentMO)"
        }
      },
      "error_handling": {
        "update_failure": "Logs error and throws exception",
        "save_failure": "Shows error message in changes indicator",
        "button_recovery": "Re-enables save button on error"
      }
    },
    "completion_calculation_system": {
      "calculation_function": {
        "function_name": "calculateCompletionPercentage(processes)",
        "location": "Line 405-425",
        "formula": "(completed_processes / total_processes) * 100",
        "logic": {
          "process_counting": "Counts total number of processes",
          "completion_checking": "Counts processes with status 'Done'",
          "percentage_calculation": "Rounds to nearest integer"
        }
      },
      "display_update": {
        "function_name": "updateCompletionDisplay(percentage)",
        "location": "Line 427-440",
        "updates": {
          "percentage_text": "Updates completion percentage display",
          "progress_bar": "Updates progress bar width",
          "mo_status": "Updates overall MO status based on completion"
        }
      },
      "mo_status_calculation": {
        "function_name": "calculateMOStatus(processes)",
        "location": "Line 442-450",
        "logic": {
          "all_done": "Returns 'Completed' if all processes are 'Done'",
          "all_none": "Returns 'Not Started' if all processes are 'None'",
          "mixed": "Returns 'Active' for any other combination"
        }
      }
    },
    "mark_all_as_done_functionality": {
      "individual_process_marking": {
        "function_name": "markAllProcessAsDone(processName)",
        "location": "Line 1820-1870",
        "behavior": {
          "target_selection": "Finds all processes with matching name",
          "status_update": "Changes all matching processes to 'Done'",
          "change_tracking": "Stores changes in statusChanges Map",
          "count_tracking": "Tracks how many statuses were updated"
        }
      },
      "all_processes_marking": {
        "function_name": "markAllAsDone()",
        "location": "Line 1684-1720",
        "behavior": {
          "target_selection": "Selects all status badges in the table",
          "status_update": "Changes all statuses to 'Done'",
          "change_tracking": "Stores all changes in statusChanges Map",
          "ui_feedback": "Shows loading state and success message"
        }
      }
    },
    "data_flow_summary": {
      "initial_load": {
        "trigger": "Page load or MO selection change",
        "process": "fetchMOData() → Database query → UI rendering",
        "output": "Parts table with process statuses displayed"
      },
      "status_change": {
        "trigger": "User clicks status badge and selects new status",
        "process": "updateStatus() → UI update → Change tracking → Completion recalculation",
        "output": "Updated UI and pending changes stored in memory"
      },
      "data_save": {
        "trigger": "User clicks 'Done Changes' button",
        "process": "saveAllChanges() → Batch database updates → UI refresh",
        "output": "Changes saved to database and UI synchronized"
      }
    },
    "key_advantages": {
      "memory_efficiency": "Changes stored in memory until explicitly saved",
      "batch_operations": "Multiple changes saved in single database operation",
      "real_time_feedback": "UI updates immediately while changes are pending",
      "error_recovery": "Failed saves don't affect other pending changes",
      "data_integrity": "UI refresh ensures consistency with database"
    },
    "error_handling_strategies": {
      "authentication_errors": "Redirect to login page",
      "fetch_errors": "Display error messages in UI",
      "save_errors": "Show error in changes indicator and re-enable save button",
      "network_errors": "Console logging and user notification",
      "data_validation": "Input validation before database operations"
    }
  }
} 